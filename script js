


document.addEventListener("DOMContentLoaded", function () {
    // Handle "Book" button clicks under Featured Destinations
    document.querySelectorAll(".booking").forEach(button => {
        button.addEventListener("click", function () {
            window.location.href = "#tourForm"; // Scrolls to the booking form
        });
    });

    // Handle "Review Us" button clicks under Featured Destinations
    document.querySelectorAll(".user-review").forEach(button => {
        button.addEventListener("click", function () {
            window.location.href = "#review-form"; // Scrolls to the review form
        });
    });

    // Handle "Book Now" button clicks under Tour Packages
    window.bookTour = function (toursPackages) {
        window.location.href = "#tourForm"; // Scrolls to the booking form
    };
});



// Function to handle searching for a destination
function searchDestination() {
    // Get user input from the search bar
    let searchInput = document.querySelector(".search-bar").value.trim().toLowerCase();
    
    // Get all existing destinations
    let destinations = document.querySelectorAll(".destination .buttons .booking");
    
    // Create an array of available destinations
    let availableDestinations = [];
    destinations.forEach(button => {
        availableDestinations.push(button.getAttribute("data-place").toLowerCase());
    });

    // Check if the destination exists
    if (availableDestinations.includes(searchInput)) {
        alert(`We have tours to ${searchInput.charAt(0).toUpperCase() + searchInput.slice(1)}! Click 'Book' to reserve your spot.`);
    } else {
        alert("Sorry, we donâ€™t offer services there yet. Continue exploring!");
    }
}

// Attach event listener to the search button
document.querySelector(".search-btn").addEventListener("click", searchDestination);

// Allow pressing "Enter" to trigger search
document.querySelector(".search-bar").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
        event.preventDefault();
        searchDestination();
    }
});
document.getElementById("tourForm").addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent page reload

    // Get form values
    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const destination = document.getElementById("destination").value;
    const date = document.getElementById("date").value;
    const people = document.getElementById("people").value;

    // Create booking object
    const bookingData = {
        name: name,
        email: email,
        destination: destination,
        date: date,
        people: people
    };

    // Send data to db.json (JSON Server API)
    fetch("http://localhost:3000/bookings", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(bookingData)
    })
    .then(response => response.json())
    .then(data => {
        alert("Booking successful! Your details have been recorded.");
        document.getElementById("tourForm").reset(); // Clear form
    })
    .catch(error => {
        alert("Error booking the tour. Please try again.");
        console.error("Booking error:", error);
    });
});

document.addEventListener("DOMContentLoaded", function () {
    const reviewForm = document.getElementById("review-form");

    // Ensure form exists
    if (!reviewForm) {
        console.error("Missing #review-form in HTML.");
        return;
    }

    // Handle form submission
    reviewForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const reviewerName = document.getElementById("reviewer-name").value;
        const reviewRating = document.getElementById("review-rating").value;
        const reviewText = document.getElementById("review-text").value;

        if (!reviewerName || !reviewRating || !reviewText) {
            alert("Please fill in all fields before submitting.");
            return;
        }

        const newReview = {
            id: Date.now(), // Unique ID
            name: reviewerName,
            rating: reviewRating,
            text: reviewText
        };

        // Save to db.json
        fetch("http://localhost:3000/reviews", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(newReview)
        })
        .then(response => response.json())
        .then(() => {
            reviewForm.reset(); // Clear form after submission
            alert("Review submitted successfully!");
        })
        .catch(error => console.error("Error saving review:", error));
    });
});


document.addEventListener("DOMContentLoaded", function () {
    const bookingForm = document.getElementById("booking-form");

    if (!bookingForm) {
        console.error("Missing #booking-form in HTML.");
        return;
    }

    bookingForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const userName = document.getElementById("user-name").value;
        const userEmail = document.getElementById("user-email").value;
        const destinationId = document.getElementById("destination-id").value; 
        const tripDuration = document.getElementById("trip-duration").value;

        if (!userName || !userEmail || !destinationId || !tripDuration) {
            alert("Please fill in all fields.");
            return;
        }

        // Check if user exists in `users` array
        fetch("http://localhost:3000/users")
            .then(response => response.json())
            .then(users => {
                const existingUser = users.find(user => user.email === userEmail);

                const userData = {
                    name: userName,
                    email: userEmail,
                    lastBookedTrip: destinationId,
                    lastTripDuration: tripDuration
                };

                if (existingUser) {
                    // Update user info
                    fetch(`http://localhost:3000/users/${existingUser.id}`, {
                        method: "PATCH",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(userData)
                    })
                    .then(response => response.json())
                    .then(() => alert("Booking updated successfully!"))
                    .catch(error => console.error("Error updating booking:", error));
                } else {
                    // Add new user
                    fetch("http://localhost:3000/users", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(userData)
                    })
                    .then(response => response.json())
                    .then(() => alert("Booking saved successfully!"))
                    .catch(error => console.error("Error saving booking:", error));
                }
            })
            .catch(error => console.error("Error fetching users:", error));
    });
});
